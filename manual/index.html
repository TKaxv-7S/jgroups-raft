<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Bela Ban &lt;belaban@yahoo.com&gt;">
<title>Distributed consensus with jgroups-raft</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: rgba(0, 0, 0, 0.8); padding: 0; margin: 0; font-family: "Noto Serif", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #7a2518; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: rgba(0, 0, 0, 0.8); border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { display: inline-block; color: rgba(0, 0, 0, 0.8); font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: rgba(0, 0, 0, 0.8); }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #7a2518; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Noto Serif", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #7a2518; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: rgba(0, 0, 0, 0.8); font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #19407c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: rgba(0, 0, 0, 0.8); -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

h1, h2 { letter-spacing: -0.01em; }

dt, th.tableblock, td.content { text-rendering: optimizeLegibility; }

p, td.content { letter-spacing: -0.01em; }
p strong, td.content strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content { font-size: 1.0625rem; }

p { margin-bottom: 1.25rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
  * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after, a[href^="mailto:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img { page-break-inside: avoid; }
  thead { display: table-header-group; }
  img { max-width: 100% !important; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  .sect1 { padding-bottom: 0 !important; }
  .sect1 + .sect1 { border: 0 !important; }
  #header > h1:first-child { margin-top: 1.25rem; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { background: none !important; padding: 0 0.9375em; }
  #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Distributed consensus with jgroups-raft</h1>
<div class="details">
<span id="author" class="author">Bela Ban &lt;belaban@yahoo.com&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#_architecture">1.1. Architecture</a></li>
</ul>
</li>
<li><a href="#_using_jgroups_raft">2. Using jgroups-raft</a>
<ul class="sectlevel2">
<li><a href="#_cluster_members_and_identity">2.1. Cluster members and identity</a></li>
<li><a href="#_rafthandle">2.2. RaftHandle</a>
<ul class="sectlevel3">
<li><a href="#_creation">2.2.1. Creation</a></li>
<li><a href="#_making_changes">2.2.2. Making changes</a></li>
<li><a href="#ImplementingStateMachine">2.2.3. Implementing a StateMachine</a></li>
<li><a href="#Snapshots">2.2.4. Snapshotting and state transfer</a></li>
<li><a href="#_miscellaneous_methods">2.2.5. Miscellaneous methods</a></li>
</ul>
</li>
<li><a href="#_configuration">2.3. Configuration</a></li>
<li><a href="#DynamicMembership">2.4. Adding and removing members dynamically</a></li>
</ul>
</li>
<li><a href="#BuildingBlocks">3. Building blocks</a>
<ul class="sectlevel2">
<li><a href="#ReplicatedStateMachine">3.1. ReplicatedStateMachine</a>
<ul class="sectlevel3">
<li><a href="#_reads_and_consensus">3.1.1. Reads and consensus</a></li>
</ul>
</li>
<li><a href="#CounterService">3.2. CounterService</a>
<ul class="sectlevel3">
<li><a href="#_synchronous_counters">3.2.1. Synchronous counters</a></li>
<li><a href="#_asynchronous_counters">3.2.2. Asynchronous counters</a></li>
<li><a href="#_reads_and_consensus_2">3.2.3. Reads and consensus</a></li>
<li><a href="#_ignoring_return_values">3.2.4. Ignoring return values</a></li>
</ul>
</li>
<li><a href="#_cluster_singleton_service">3.3. Cluster singleton service</a></li>
</ul>
</li>
<li><a href="#protlist">4. List of protocols</a>
<ul class="sectlevel2">
<li><a href="#NO_DUPES">4.1. NO_DUPES</a></li>
<li><a href="#ELECTION">4.2. ELECTION</a></li>
<li><a href="#ELECTION2">4.3. ELECTION2</a></li>
<li><a href="#RAFT">4.4. RAFT</a></li>
<li><a href="#REDIRECT">4.5. REDIRECT</a></li>
<li><a href="#CLIENT">4.6. CLIENT</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Copyright Red Hat 2014 - 2023</p>
</div>
<div class="paragraph">
<p>This document is licensed under the
<a href="http://creativecommons.org/licenses/by-sa/3.0/us/legalcode">"Creative Commons Attribution-ShareAlike (CC-BY-SA) 3.0"</a>
license.</p>
</div>
<div class="paragraph">
<p>This is the jgroups-raft manual. It provides information about</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Design and architecture</p>
</li>
<li>
<p>Configuration and use</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>of jgroups-raft.</p>
</div>
<div class="paragraph">
<p>Bela Ban, Kreuzlingen Switzerland 2017</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="http://www.github.com/belaban/jgroups-raft">jgroups-raft</a> project is an implementation of
<a href="https://raftconsensus.github.io/">Raft</a> in <a href="http://www.jgroups.org">JGroups</a>.</p>
</div>
<div class="paragraph">
<p>It provides a consensus based system where leader election and changes are committed by <em>consensus</em> (majority agreement).
A fixed number of nodes form a cluster and each node is a state machine. A leader is elected by consensus and all
changes happen through the leader which replicates them to all nodes, which add them to their persistent log.</p>
</div>
<div class="paragraph">
<p>Because Raft guarantees that there&#8217;s only ever one leader at any time, and changes are identified uniquely, all state
machines receive the same ordered stream of updates and thus have the exact same state.</p>
</div>
<div class="paragraph">
<p>Raft favors <em>consistency</em> over <em>availability</em>; in terms of the <a href="http://en.wikipedia.org/wiki/CAP_theorem">Cap theorem</a>,
jgroups-raft is a CP system. This means jgroups-raft is highly consistent, and the data replicated to nodes will never
diverge, even in the face of network partitions (split brains), or restarts. Or, on an extended version, jgroups-raft
provides the means to build PC/EC systems concerning the <a href="https://en.wikipedia.org/wiki/PACELC_theorem">PACELC theorem</a>.</p>
</div>
<div class="paragraph">
<p>In case of a network partition, in a cluster of <code>N</code> nodes, at least <code>N/2+1</code> nodes have to be running for the
system to be available.</p>
</div>
<div class="paragraph">
<p>If for example, in a 5 node cluster, 2 nodes go down, then the system can still commit changes
and elect leaders as 3 is still the majority. However, if another node goes down, the system becomes unavailable and client
requests will be rejected. (Depending on configuration, there may still be some limited form of read-only availability.)</p>
</div>
<div class="paragraph">
<p>By implementing jgroups-raft in JGroups, the following benefits can be had:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transports already available: UDP, TCP</p>
<div class="ulist">
<ul>
<li>
<p>Contains thread pools, priority delivery (OOB), batching etc</p>
</li>
</ul>
</div>
</li>
<li>
<p>Variety of discovery protocols</p>
</li>
<li>
<p>Encryption, authentication, compression</p>
</li>
<li>
<p>Fragmentation, reliability over UDP</p>
</li>
<li>
<p>Multicasting for larger clusters</p>
</li>
<li>
<p>Failure detection</p>
</li>
<li>
<p>Sync/async cluster RPCs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code required to be written for a full Raft implementation is smaller than if it had been implemented outside of JGroups.</p>
</div>
<div class="paragraph">
<p>The feature set of jgroups-raft includes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Leader election and append entries functionality by consensus</p>
</li>
<li>
<p>Persistent log (using LevelDB)</p>
</li>
<li>
<p>Dynamic addition and removal of cluster nodes</p>
</li>
<li>
<p>Cluster wide atomic counters</p>
</li>
<li>
<p>Replicated hash maps (replicated state machines)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_architecture">1.1. Architecture</h3>
<div class="paragraph">
<p>The architecture of jgroups-raft is shown below.</p>
</div>
<div id="ArchitectureFig" class="imageblock">
<div class="content">
<img src="images/Architecture.png" alt="Architecture of jgroups-raft,align=left,valign=top,width=" width="60%"">
</div>
<div class="title">Figure 1. The architecture of jgroups-raft</div>
</div>
<div class="paragraph">
<p>The components that make up jgroups-raft are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A JGroups protocol stack with jgroups-raft specific protocols added:</p>
<div class="ulist">
<ul>
<li>
<p><code>NO_DUPES</code>: makes sure that a jgroups-raft node does not appear in a view more than once</p>
</li>
<li>
<p><code>ELECTION</code>: handles leader election</p>
</li>
<li>
<p><code>RAFT</code>: implements the Raft algorithm, ie. appending entries to the persistent log, committing them, syncing new members etc</p>
</li>
<li>
<p><code>REDIRECT</code> (not shown): redirects requests to the leader</p>
</li>
<li>
<p><code>CLIENT</code>: accepts client requests over a socket, executes them and sends the results back to the clients</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Channel</code>: this is a regular JGroups <code>JChannel</code> or <code>ForkChannel</code></p>
</li>
<li>
<p><code>RaftHandle</code>: the main class for users of jgroups-raft to interact with</p>
</li>
<li>
<p><code>StateMachine</code>: an implementation of <code>StateMachine</code>. This is typically a replicated state machine. jgroups-raft
ships with a number of building blocks implementing <code>StateMachine</code> such as <code>CounterService</code> or <code>ReplicatedStateMachine</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The figure above shows one node in a cluster, but the other nodes have the same setup except that every node is required
to have a different <code>raft_id</code> (defined in <code>RAFT</code>). This is a string which defines one cluster member; all members
need to have different raft_ids (more on this later).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_jgroups_raft">2. Using jgroups-raft</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since jgroups-raft build on JGroups, we follow similar <a href="http://www.jgroups.org/manual5/index.html#Requirements">requirements</a>.
Currently, jgroups-raft requires JDK 11. jgroups-raft can be included in the POM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.jgroups&lt;/groupId&gt;
    &lt;artifactId&gt;jgroups-raft&lt;/artifactId&gt;
    &lt;version&gt;X.Y.Z.Final&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>X</code>=major, <code>Y</code>=minor, and <code>Z</code>=patch.
The tags are available on <a href="https://github.com/belaban/jgroups-raft/tags">GitHub releases</a>.</p>
</div>
<div class="sect2">
<h3 id="_cluster_members_and_identity">2.1. Cluster members and identity</h3>
<div class="paragraph">
<p>Each cluster member has an address (a UUID) assigned by JGroups and a <code>raft_id</code> which needs to be assigned by the user.
The latter is a string (e.g. "A") which needs to be unique in the entire cluster. In other words, the <code>raft_id</code> is the
<em>identity</em> of a member for the sake of jgroups-raft.</p>
</div>
<div class="paragraph">
<p>A Raft cluster has a fixed size, so that a majority can be computed for leader election and appending of entries. The
members allowed into the cluster is defined in <code>RAFT.members</code>, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;raft.RAFT members="A,B,C" raft_id="${raft_id:undefined}"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines a cluster of 3 members: "A", "B" and "C" (whose majority is 2).</p>
</div>
<div class="paragraph">
<p>These are the <code>raft_id</code> attributes of the 3 members, so attribute <code>raft_id</code> in the example above needs to be one of them.
If we don&#8217;t start this member with the system property <code>-Draft_id=X</code> (where X needs to be "A", "B", or "C"),
then the member will start up as "undefined" is not a member of <code>{"A", "B", "C"}</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
Note that while <code>RAFT</code> ensures that non-members cannot join a cluster, the <code>NO_DUPES</code> protocol makes sure that
no duplicate member can join. Example: if we have <code>RAFT.members="A,B,C"</code> and actual members "A" and "B" joined, then
a join attempt by a member with duplicate name "B" will be rejected and that member won&#8217;t be able to join.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Attribute <code>raft_id</code> is also used to define the location of the persistent log; unless <code>log_name</code> is defined in
<code>RAFT</code>, the location is computed as <code>&lt;temp_dir&gt;/&lt;raft_id&gt;.log</code>, e.g. <code>/tmp/A.log</code>.</p>
</div>
<div class="paragraph">
<p>Note that members can be added and removed dynamically (without taking the entire cluster down, changing the configuration
and restarting it), see <a href="#DynamicMembership">Adding and removing members dynamically</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rafthandle">2.2. RaftHandle</h3>
<div class="paragraph">
<p>As shown in <a href="#ArchitectureFig">The architecture of jgroups-raft</a>, <code>RaftHandle</code> is the main class users will be dealing with. It provides methods to change
state (append entries) in the replicated state machines, and a state machine can be registered with it. The state machine
will be initialized at startup and updated by jgroups-raft whenever there is a change.</p>
</div>
<div class="paragraph">
<p>A successful change is committed to the persistent logs of all cluster members and applied to their state machines, so
all state machines have exactly the same state.</p>
</div>
<div class="sect3">
<h4 id="_creation">2.2.1. Creation</h4>
<div class="paragraph">
<p>An instance of RaftHandle is associated with exactly <em>one</em> JGroups channel, and can be created as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JChannel ch=new JChannel("/home/bela/raft.xml"); <img src="./images/icons/callouts/1.png" alt="1">
RaftHandle handle=new RaftHandle(ch, this);      <img src="./images/icons/callouts/2.png" alt="2">
ch.connect("raft-cluster");                      <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>A new JGroups channel is created (see the JGroups manual for details on the JGroups API)</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>A RaftHandle instance is created over the channel (which must be non-null). The second argument is an implementation
of <code>StateMachine</code>. If null, no changes will be applied. The state machine can be set with <code>stateMachine(StateMachine sm)</code>.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>The channel is connected which causes the member to join the cluster</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_making_changes">2.2.2. Making changes</h4>
<div class="paragraph">
<p>The <code>setX()</code> methods can be used to make changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">byte[] set(byte[] buf, int offset, int length) throws Exception; <img src="./images/icons/callouts/1.png" alt="1">
byte[] set(byte[] buf, int offset, int length, long timeout, TimeUnit unit) throws Exception; <img src="./images/icons/callouts/2.png" alt="2">
CompletableFuture&lt;byte[]&gt; setAsync(byte[] buf, int offset, int length); <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Synchronous change; the caller will be blocked until the change has been forwarded to the leader, which sends it to
all cluster members which apply it to their persistent logs and ack the change back to the leader. Once the leader
gets a majority of acks, it commits the change to its own log, applies it to its state machine and returns the
response to the caller. The state machines thus only contain <em>committed changes</em>.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Same as above, except that this call is bounded with a timeout. If it elapses before a majority of acks have been
received, a <code>TimeoutException</code> will be thrown.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Asynchronous change; this method returns immediately with a <code>CompletableFuture</code> which can be used to retrieve the
result later, or to provide some code that&#8217;s executed as soon as the result is available (e.g. <code>whenComplete()</code>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The contents of the request and response buffers is application specific.</p>
</div>
<div class="paragraph">
<p>For example, if we implemented a replicated hash map, then a request could be a <code>put(key,value)</code>. The <code>put()</code>
would have to be serialized into the buffer, as well as the key and the value.</p>
</div>
<div class="paragraph">
<p>When committing the change, every state machine needs to de-serialize the buffer into a <code>put(key,value)</code> and apply it to
its state (see <a href="#ImplementingStateMachine">Implementing a StateMachine</a>). If there is a return value to the <code>put()</code> call, e.g. the previous value
associated with <code>key</code>, then it will be serialized into a buffer and returned as result of one of the <code>setX()</code> calls.</p>
</div>
</div>
<div class="sect3">
<h4 id="ImplementingStateMachine">2.2.3. Implementing a StateMachine</h4>
<div class="paragraph">
<p><code>StateMachine</code> is an interface and is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface StateMachine {
    byte[] apply(byte[] data, int offset, int length) throws Exception;  <img src="./images/icons/callouts/1.png" alt="1">
    void   readContentFrom(DataInput in) throws Exception;               <img src="./images/icons/callouts/2.png" alt="2">
    void   writeContentTo(DataOutput out) throws Exception;              <img src="./images/icons/callouts/3.png" alt="3">
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>This method is called whenever a log entry is <em>committed</em>. The buffer&#8217;s contents are application specific (e.g this
could be a serialized <code>put(key,value)</code> as discussed above. If there is a return value of applying the change to the
state machine, it needs to be serialized so that it can be returned to the caller (e.g. a client).</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>This method is called when <code>RAFT</code> needs to initialize a state machine from a <em>snapshot</em> (a dump of a state
machine&#8217;s contents to an external stream (e.g. a file)). The <code>writeContentTo()</code> method below wrote the contents
to a file before, in an application specific format, and this method now needs to read the contents back into the
state machine.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>This method is the opposite of <code>readContentFrom()</code> and writes the contents of this state machine to a stream
(e.g. a file).</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Snapshots">2.2.4. Snapshotting and state transfer</h4>
<div class="paragraph">
<p>All cluster members maintain a persistent log and append all changes as log entries to the end of the log. To prevent
logs from growing indefinitely, a <em>snapshot</em> of the state machine can be made and the log truncated. This is done
(programatically) with method <code>snapshot()</code>, or declaratively (see below).</p>
</div>
<div class="paragraph">
<p>This method calls <code>StateMachine.writeContentTo()</code> to dump the state of the state machine into a snapshot file and then
truncates the log. New members who don&#8217;t have a log yet are initialized by sending them the snapshot first. After that,
they will catch up via the regular Raft mechanism.</p>
</div>
<div class="paragraph">
<p>Logs can be snapshot automatically by setting <code>RAFT.max_log_size</code> to the max number of bytes that a log is allowed to
grow to until a snapshot is taken.</p>
</div>
</div>
<div class="sect3">
<h4 id="_miscellaneous_methods">2.2.5. Miscellaneous methods</h4>
<div class="paragraph">
<p>Other methods in <code>RaftHandle</code> include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">addServer(String server)</dt>
<dd>
<p>Asynchronously adds a new member to the cluster with id <code>server</code> and returns a
<code>CompletableFuture&lt;byte[]&gt;</code>. See more about membership change in <a href="#DynamicMembership">Adding and removing members dynamically</a>.</p>
</dd>
<dt class="hdlist1">removeServer(String server)</dt>
<dd>
<p>Asynchronously removes a member from the cluster with id <code>server</code> and returns a
<code>CompletableFuture&lt;byte[]&gt;</code>. See more about membership change in <a href="#DynamicMembership">Adding and removing members dynamically</a>.</p>
</dd>
<dt class="hdlist1">leader()</dt>
<dd>
<p>Returns the address of the current Raft leader, or null if there is no leader (e.g. in case there was no
majority to elect a leader)</p>
</dd>
<dt class="hdlist1">isLeader()</dt>
<dd>
<p>Whether or not the current member is the leader</p>
</dd>
<dt class="hdlist1">addRoleListener(RAFT.RoleChange listener)</dt>
<dd>
<p>Allows to register a  <code>RoleChange</code> listener which is notified when the current
member changes its role (<code>Leader</code>, <code>Follower</code>, <code>Candidate</code>)</p>
</dd>
<dt class="hdlist1">currentTerm()</dt>
<dd>
<p>Returns the current term (see Raft for details)</p>
</dd>
<dt class="hdlist1">lastApplied()</dt>
<dd>
<p>Returns the index of the last log entry that was appended to the log</p>
</dd>
<dt class="hdlist1">commitIndex()</dt>
<dd>
<p>Returns the index of the last log entry that was committed</p>
</dd>
<dt class="hdlist1">raft()</dt>
<dd>
<p>Returns a reference to the <code>RAFT</code> protocol in the current member&#8217;s stack. Provided for experts who need to
access <code>RAFT</code> directly.</p>
</dd>
<dt class="hdlist1">raftId(String id)</dt>
<dd>
<p>Used to set the <code>raft_id</code> programmatically (note that this can also be done by setting <code>raft_id</code> in
<code>RAFT</code> in the XML configuration. For example, the following code sets <code>raft_id</code> from the command line:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">protected void start(String raft_id) throws Exception {
    JChannel ch=new JChannel("raft.xml").name(raft_id);   <img src="./images/icons/callouts/2.png" alt="2">
    RaftHandle handle=new RaftHandle(ch, this).raftId(raft_id); <img src="./images/icons/callouts/3.png" alt="3">
    ch.connect("raft-cluster");  <img src="./images/icons/callouts/4.png" alt="4">
}

public static void main(String[] args) throws Exception {
    new bla().start(args[0]);  <img src="./images/icons/callouts/1.png" alt="1">
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>The <code>raft_id</code> can for example be passed to the program as an argument</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>The channel is created and its logical name set to be the same as <code>raft_id</code>. This is not necessary, but convenient.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Now <code>raft_id</code> can be set via <code>RaftHandle.raftId(String id)</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">2.3. Configuration</h3>
<div class="paragraph">
<p>The configuration of a member is either done declaratively via an XML config file or programmatically. Refer to the
JGroups documentation for details.</p>
</div>
<div class="paragraph">
<p>A sample XML configuration file is shown below (edited for brevity):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;config xmlns="urn:org:jgroups"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="urn:org:jgroups http://www.jgroups.org/schema/jgroups.xsd"&gt;
    &lt;UDP
         mcast_addr="228.5.5.5"
         mcast_port="${jgroups.udp.mcast_port:45588}"/&gt;
    &lt;PING /&gt;
    &lt;MERGE3 /&gt;
    &lt;FD_SOCK/&gt;
    &lt;FD_ALL/&gt;
    &lt;VERIFY_SUSPECT timeout="1500"  /&gt;
    &lt;pbcast.NAKACK2 xmit_interval="500"/&gt;
    &lt;UNICAST3 xmit_interval="500"/&gt;
    &lt;pbcast.STABLE desired_avg_gossip="50000"
                   max_bytes="4M"/&gt;
    &lt;raft.NO_DUPES/&gt;                                                         <img src="./images/icons/callouts/1.png" alt="1">
    &lt;pbcast.GMS print_local_addr="true" join_timeout="2000"/&gt;
    &lt;UFC max_credits="2M" min_threshold="0.4"/&gt;
    &lt;MFC max_credits="2M" min_threshold="0.4"/&gt;
    &lt;FRAG2 frag_size="60K"  /&gt;
    &lt;raft.ELECTION election_min_interval="100" election_max_interval="500"/&gt; <img src="./images/icons/callouts/2.png" alt="2">
    &lt;raft.RAFT members="A,B,C,D" raft_id="${raft_id:undefined}"/&gt;            <img src="./images/icons/callouts/3.png" alt="3">
    &lt;raft.REDIRECT/&gt;                                                         <img src="./images/icons/callouts/4.png" alt="4">
    &lt;raft.CLIENT bind_addr="0.0.0.0" /&gt;                                      <img src="./images/icons/callouts/5.png" alt="5">
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td><code>NO_DUPES</code>: checks that joining a new member doesn&#8217;t lead to duplicate <code>raft_ids</code> in the membership. Rejects the
JOIN if it would. Must be placed somewhere <em>below</em> <code>GMS</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td><code>ELECTION</code>: this protocol implements leader election, as defined in Raft. It is independent from <code>RAFT</code> and could
(and may, in the future) be replaced with a different election protocol. Attributes <code>election_min_interval</code> and
<code>election_max_interval</code> define the range from which jgroups-raft picks a random election timeout.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td><code>RAFT</code>: the main protocol implementing log appending and committing, handling state machine updates, snapshotting etc.
Attribute <code>members</code> defines the (fixed) membership (may still be redfined by <code>addServer</code>/<code>removeServer</code> log entries
when initializing a member from the persistent log). Attribute <code>raft_id</code> defines the ID of the current member (needs
to be an element of <code>members</code>, as discussed earlier).</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td><code>REDIRECT</code> is used to redirect requests to the current Raft leader, or to throw an exception if no member is leader</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td><code>CLIENT</code> listens on a socket (port <code>1965</code> by default) for client requests, executes them and sends the result back
to the clients. Currently, <code>addServer</code> and <code>removeServer</code> has been implemented.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is a regular JGroups XML configuration, except that jgroups-raft added a few additional protocols.</p>
</div>
</div>
<div class="sect2">
<h3 id="DynamicMembership">2.4. Adding and removing members dynamically</h3>
<div class="paragraph">
<p>The <code>RAFT</code> protocol provides methods <code>addServer(String raft_id)</code> and <code>removeServer(String raft_id)</code> to add and remove
servers from the static membership (defined by <code>RAFT.members</code>). Only one server at a time can be added and removed, and
adding or removing a server needs a majority ack to be committed.</p>
</div>
<div class="paragraph">
<p>Both methods are exposed via JMX, so <code>jconsole</code> could be used. However, jgroups-raft also provides a script
(<code>client.sh</code>) to do this in a more convenient way. The script uses <code>Client</code> to connect to a member&#8217;s <code>CLIENT</code> protocol
running at <code>localhost:1965</code> (can be changed). The request is then forwarded to the current leader.</p>
</div>
<div class="paragraph">
<p>The steps to add a member are as follows (say we have <code>RAFT.members="A,B,C"</code> and want to add "D"):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Call <code>bin/client.sh -add D</code></p>
<div class="ulist">
<ul>
<li>
<p>If needed, <code>-port PORT</code> or <code>-bind_addr ADDR</code> can be given, e.g. if we need to reach a member running on a different host</p>
</li>
</ul>
</div>
</li>
<li>
<p>Once <code>A</code> (the leader) processed <code>addServer("D")</code>, everybody&#8217;s <code>RAFT.members</code> is <code>"A","B","C","D"</code></p>
</li>
<li>
<p>At this point, the XML configuration files should be updated so that <code>RAFT.members="A,B,C,D"</code></p>
</li>
<li>
<p>If not, members will read the correct membership when getting initialized by their logs</p>
</li>
<li>
<p>A new member <code>D</code> can now be started (its XML config needs to have the correct <code>members</code> attribute !)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notice that membership changes survive through restarts. If a node must be removed or added, an operation must be
submitted, only restarting does not affect membership.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="BuildingBlocks">3. Building blocks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similar to JGroups' building blocks, jgroups-raft also has building blocks, which provide additional functionality on
top of a <code>RaftHandle</code>. They are typically given a JChannel, create a <code>RaftHandle</code> and register themselves as
<code>StateMachine</code> with the handle. Building blocks offer a different interface to the users, e.g. a replicated hashmap
with puts and gets, or a distributed counter or lock.</p>
</div>
<div class="sect2">
<h3 id="ReplicatedStateMachine">3.1. ReplicatedStateMachine</h3>
<div class="paragraph">
<p><code>ReplicatedStateMachine</code> is a key-value store replicating its contents to all cluster members. Contrary to the JGroups
equivalent (<code>ReplicatedHashMap</code>), changes are replicated by consensus and logged to a persistent log.</p>
</div>
<div class="paragraph">
<p>While the JGroups version is allowed to make progress during network partitions, and users need to merge possibly
diverging state from different partitions after a partition heals, <code>ReplicatedStateMachine</code> will allow progress only in
the <em>majority partition</em>, so no state merging needs to be done after a partition heals.</p>
</div>
<div class="paragraph">
<p>Not having to merge state is certainly simpler, but comes at the expense of availability: if <code>N/2+1</code> members leave or
split into different partitions, <code>ReplicatedStateMachine</code> will be unavailable (all requests will time out).</p>
</div>
<div class="paragraph">
<p>However, the advantage is that the members' states will never diverge.</p>
</div>
<div class="paragraph">
<p><code>ReplicatedStateMachine</code> requires a <code>JChannel</code> in its constructor and has <code>put()</code>, <code>get()</code> and <code>remove()</code> methods.
The code below shows how to create an instance of <code>ReplicatedStateMachine</code> and add an element to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">protected void start(String raft_id) throws Exception {
    JChannel ch=new JChannel("raft.xml").name(raft_id);
    ReplicatedStateMachine&lt;String,String&gt; rsm=new ReplicatedStateMachine&lt;&gt;(ch)
        .raftId(raft_id);
    ch.connect("rsm-cluster");
    rsm.put("name", "Bela");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s a demo <code>ReplicatedStateMachineDemo</code> which can be used to interactively use <code>ReplicatedStateMachine</code>.</p>
</div>
<div class="sect3">
<h4 id="_reads_and_consensus">3.1.1. Reads and consensus</h4>
<div class="paragraph">
<p><code>ReplicatedStateMachine</code> has a configurable behavior for reads, using quorum reads by default. This means that all read
requests are sent through <code>RAFT</code> and require a majority to complete. This provides a linearizable read, but, on the other
hand, it takes longer to complete.</p>
</div>
<div class="paragraph">
<p>If an application does not require linearizable reads, it can change the behavior and only read the value locally,
possibly stale, but having a faster response since the request does not go through <code>RAFT</code>.</p>
</div>
<div class="paragraph">
<p>The behavior is changed by calling <code>ReplicatedStateMachine.allowDirtyReads(boolean)</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
A quorum read creates an entry in the persistent log. See
<a href="https://github.com/belaban/jgroups-raft/issues/18">Issue 18</a> for details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="CounterService">3.2. CounterService</h3>
<div class="paragraph">
<p><code>CounterService</code> provides a replicated counter which can be used in a synchronous (<code>SyncCounter</code>) and asynchronous
(<code>AsyncCounter</code>) mode. The base interface is <code>Counter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Counter {
    String                getName();
    SyncCounter           sync();
    AsyncCounter          async();
    &lt;T extends Counter&gt; T withOptions(Options opts);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>sync()</code> and <code>async()</code> methods can be used to switch between the modes. The <code>withOptions()</code> method can be used to
make a counter ignore return values (see below).</p>
</div>
<div class="sect3">
<h4 id="_synchronous_counters">3.2.1. Synchronous counters</h4>
<div class="paragraph">
<p>Synchronous counters block until an operation has completed, and return a value. The interface <code>SyncCounter</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface SyncCounter extends Counter {
    long            get();
    long            getLocal();
    void            set(long new_value);
    default boolean compareAndSet(long exp, long upd) {return compareAndSwap(exp, upd) == exp;}
    long            compareAndSwap(long expect, long update);
    default long    incrementAndGet() {return addAndGet(1L);}
    default long    decrementAndGet() {return addAndGet(-1L);}
    long            addAndGet(long delta);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The methods are:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the value of the counter. If the CounterService allows for dirty reads (see below), <code>getLocal()</code> is
          called. Otherwise, a remote get request is sent to the leader.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getLocal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the value of the counter. This call is purely local and may return a stale value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compareAndSet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomically updates the counter using a CAS operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compareAndSwap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomically updates the counter using a compare-and-swap operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incrementAndGet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomically increments the counter and returns the new value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>decrementAndGet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomically decrements the counter and returns the new value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addAndGet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomically adds the given value to the current value</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The synchronous methods block until consensus has been reached. This means that a method (e.g. <code>addAndGet()</code>) may block
indefinitely, e.g. when less than a majority of members have ack&#8217;ed the change.</p>
</div>
</div>
<div class="sect3">
<h4 id="_asynchronous_counters">3.2.2. Asynchronous counters</h4>
<div class="paragraph">
<p>Asynchronous counters are defined in <code>AsyncCounter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface AsyncCounter extends Counter {
    default CompletionStage&lt;Long&gt;    get() {return addAndGet(0);}
    CompletionStage&lt;Long&gt;            getLocal();
    CompletionStage&lt;Void&gt;            set(long new_value);

    default CompletionStage&lt;Boolean&gt; compareAndSet(long expect, long update) {
        return compareAndSwap(expect, update).thenApply(value -&gt; value == expect);
    }
    CompletionStage&lt;Long&gt;            compareAndSwap(long expect, long update);
    default CompletionStage&lt;Long&gt; incrementAndGet() {
        return addAndGet(1);
    }
    default CompletionStage&lt;Long&gt;    decrementAndGet() {
        return addAndGet(-1);
    }
    CompletionStage&lt;Long&gt;            addAndGet(long delta);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The semantics of the methods correspond to their synchronous counterparts, but they return a <code>CompletionStage</code> instead
of the value. An example is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void testCompareAndSwapChained() {
    AsyncCounter counter=counter_service.getOrCreateCounte("ctr", 0).async();
    final long initialValue = 100;
    final long finalValue = 10;

    counter.set(initialValue).toCompletableFuture().join();

    AtomicLong rv = new AtomicLong();
    boolean result = counter.compareAndSwap(1, finalValue)
            .thenCompose(rValue -&gt; {
                rv.set(rValue);
                return counters.get(0).compareAndSwap(rValue, finalValue);
            })
            .thenApply(value -&gt; value == initialValue)
            .toCompletableFuture()
            .join();

    assert result;
    assert initialValue == rv.longValue();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>Counter</code> implementation is created via the <code>CounterService</code> building block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CounterService implements StateMachine {
    public CounterService(Channel ch);
    public long           replTimeout();
    public CounterService replTimeout(long timeout);
    public boolean        allowDirtyReads();
    public CounterService allowDirtyReads(boolean flag);
    public CounterService raftId(String id);

    /**
     * Returns an existing counter, or creates a new one if none exists
     * @param name Name of the counter, different counters have to have different names
     * @param initial_value The initial value of a new counter if there is no existing counter.
     * Ignored if the counter already exists
     * @return The counter implementation
     */
    public Counter getOrCreateCounter(String name, long initial_value) throws Exception;


    /**
     * Deletes a counter instance (on the coordinator)
     * @param name The name of the counter. No-op if the counter doesn't exist
     */
    public void deleteCounter(String name) throws Exception;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CounterService</code> is mainly used to get an existing or create a new <code>Counter</code> implementation (<code>getOrCreateCounter()</code>), or
to delete an existing counter (<code>deleteCounter()</code>).</p>
</div>
<div class="paragraph">
<p>To create an instance of <code>CounterService</code>, a JChannel has to be passed to the constructor. The sample code below
shows how to use this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">protected void start(String raft_id) throws Exception {
    JChannel ch=new JChannel("raft.xml").name(raft_id);
    CounterService cs=new CounterService(ch);                   <img src="./images/icons/callouts/1.png" alt="1">
    ch.connect("counter-cluster");
    SyncCounter counter=cs.getOrCreateCounter("mycounter", 1);  <img src="./images/icons/callouts/2.png" alt="2">
    counter.incrementAndGet();                                  <img src="./images/icons/callouts/3.png" alt="3">
    counter.compareAndSet(2, 5);                                <img src="./images/icons/callouts/4.png" alt="4">
    long current_value=counter.get();                           <img src="./images/icons/callouts/5.png" alt="5">
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>First a <code>CounterService</code> is created and given a reference to a channel</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Once the member has joined the cluster, we create a counter named "mycounter" with an initial value of 1</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>The counter is then incremented to 2</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>Now a compare-and-set operation sets the counter to 5 if it was 2</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>The last operation fetches the current value of "mycounter"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any member in the cluster can change the same counter and all operations are ordered by the Raft leader, which causes
the replicated counters to have exactly the same value in all members.</p>
</div>
<div class="paragraph">
<p>Comparing this to the JGroups equivalent, a jgroups-raft counter never diverges in different members, again at the
expense of availability. In the JGroups version, counters are always available, but may diverge, e.g. in a split brain
scenario, and have to be reconciled by the application after the split brain is resolved.</p>
</div>
<div class="paragraph">
<p>There&#8217;s a demo <code>CounterServiceDemo</code> which can be used to interactively manipulate replicated counters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reads_and_consensus_2">3.2.3. Reads and consensus</h4>
<div class="paragraph">
<p>Currently (as of jgroups-raft version 0.4), reading a counter is by default <em>dirty</em>, meaning that a read may return a
stale value.</p>
</div>
<div class="paragraph">
<p>This can be changed by calling <code>counter_service.allowDirtyReads(false)</code>.</p>
</div>
<div class="paragraph">
<p>However, this inserts a dummy <em>read log entry</em> which returns the value of counter when committed. Since this dummy entry
is ordered correctly wrt writes in the log, it will always return correct values.</p>
</div>
<div class="paragraph">
<p>The cost is that reads take up space in the persistent logs and that we need consensus (majority) for reads. In the next
release of jgroups-raft, the mechanism for client reads as suggested in the Raft paper will be implemented. See
<a href="https://github.com/belaban/jgroups-raft/issues/18">Issue 18</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ignoring_return_values">3.2.4. Ignoring return values</h4>
<div class="paragraph">
<p>Sometimes, a caller is not interested in the result of an operation. E.g. a stress test may want to update a counter
many times, e.g. with many different threads, and only then fetch the final counter value. When this is the case,
an <em>option</em> can be used with a counter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void testIgnoreReturnValue() {
    SyncCounter counter=counter_service.getOrCreateCounter("ctr", 0);
    long ret=counter.incrementAndGet(); <img src="./images/icons/callouts/1.png" alt="1">

    counter=counter.withOptions(Options.create(true)); <img src="./images/icons/callouts/2.png" alt="2">
    ret=counter.incrementAndGet(); <img src="./images/icons/callouts/3.png" alt="3">
    assert ret == 0;
    ret=counter.getLocal(); <img src="./images/icons/callouts/4.png" alt="4">
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In (1), a counter is incremented and the new value returned. This returns <code>1</code></p>
</div>
<div class="paragraph">
<p>In (2) , a counter is created with an <code>Option</code>, which declares that return values are to be ignored. Consequently,
when we increment the counter in (3), the return value is <code>0</code>, although the counter was indeed incremented, as
shown when fetching the value in (4).</p>
</div>
<div class="paragraph">
<p>Returning <code>0</code> may not be the most clever use of options, but is the result of autoboxing a <code>null</code> <code>Long</code> value into
a <code>long</code>. The idea is that the result of an operation that has this option set, should not be assigned to a variable.</p>
</div>
<div class="paragraph">
<p>When the ignore-return-value option is set, <code>REDIRECT</code> doesn&#8217;t need to serialize and send the result from the leader
to the follower, and <code>RAFT</code> does not need to serialize the result into a <code>byte[]</code> array, either. The cost reduction
here may not be insignificant, depending on the (serialized) size of the result values and the frequency of operations.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cluster_singleton_service">3.3. Cluster singleton service</h3>
<div class="paragraph">
<p>A <em>singleton service</em> is a service which is supposed to run only once in an entire cluster. Typically, in JGroups, a
singleton service is started on the first member of a cluster. For example, if we have <code>{A,B,C,D,E}</code>, the singleton
service (or services) would be running on <code>A</code>.</p>
</div>
<div class="paragraph">
<p>If we have a partition, such that the cluster falls apart into <code>{A,B,C}</code> and <code>{D,E}</code>, then an <em>additional</em> singleton
would be started on <code>D</code>, as <code>D</code> became coordinator and doesn&#8217;t know <code>{A,B,C}</code> didn&#8217;t leave, but were partitioned away
instead.</p>
</div>
<div class="paragraph">
<p>When the partition ends, if <code>D</code> is not coordinator anymore, it would stop its singleton services.</p>
</div>
<div class="paragraph">
<p>If multiple singletons (as provided by JGroups, e.g. during a network split) cannot be tolerated by the application,
and the application has a requirement that <em>at most one singleton service</em> can be running (better none than two),
jgroups-raft can be used.</p>
</div>
<div class="paragraph">
<p>The mechanism to implement singleton services in jgroups-raft is leader election: it is guaranteed that at most one
leader exists in a given cluster at the same time. This is exactly what we need for singletons. The code below shows
how to do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JChannel ch=null;
RaftHandle handle=new RaftHandle(ch, this); <img src="./images/icons/callouts/1.png" alt="1">
handle.addRoleListener(role -&gt; {            <img src="./images/icons/callouts/2.png" alt="2">
    if(role == Role.Leader)                 <img src="./images/icons/callouts/3.png" alt="3">
        // start singleton services
    else
        // stop singleton services
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>A <code>RaftHandle</code> is created over a channel</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>A <code>RAFT.RoleChange</code> callback is registered with the handle. Alternatively, <code>addRoleListener()</code> could be called
directly on an instance of <code>RAFT</code> retrieved from the protocol stack associated with the given channel</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>When we become the Raft leader, the singleton services can be started, when not, they should be stopped (if running)</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="protlist">4. List of protocols</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the most frequently used protocols, and their configuration.
    
Meanwhile, we recommend that users should copy one of the predefined configurations (shipped with jgroups-raft), e.g.
<code>raft.xml</code>, and make only minimal changes to it.</p>
</div>
<div class="sect2">
<h3 id="NO_DUPES">4.1. NO_DUPES</h3>
<div class="paragraph">
<p>This protocol prevents duplicate members from joining the cluster. The protocol needs to be located somewhere below
<code>GMS</code>.</p>
</div>
<div class="paragraph">
<p><code>NO_DUPES</code> catches JOIN requests from a joiner to the JGroups coordinator and checks if the joiner&#8217;s <code>raft_id</code> is
already contained in the current membership, and rejects the JOIN if this is the case.</p>
</div>
<div class="paragraph">
<p>For example, if we have current members <code>{A,B}</code> and another member with <code>raft_id</code> "B" joins, then the joiner would
get the following exception when trying to join the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-------------------------------------------------------------------
GMS: address=B, cluster=cntrs, physical address=127.0.0.1:64733
-------------------------------------------------------------------
Exception in thread "main" java.lang.Exception: connecting to channel "cntrs" failed
	at org.jgroups.JChannel._connect(JChannel.java:570)
	at org.jgroups.JChannel.connect(JChannel.java:294)
	at org.jgroups.JChannel.connect(JChannel.java:279)
	at org.jgroups.raft.demos.CounterServiceDemo.start(CounterServiceDemo.java:32)
	at org.jgroups.raft.demos.CounterServiceDemo.main(CounterServiceDemo.java:163)
Caused by: java.lang.SecurityException: join of B rejected as it would create a view with duplicate members (current view: [B|1] (2) [B, A])
	at org.jgroups.protocols.pbcast.ClientGmsImpl.isJoinResponseValid(ClientGmsImpl.java:187)
	at org.jgroups.protocols.pbcast.ClientGmsImpl.installViewIfValidJoinRsp(ClientGmsImpl.java:153)
	at org.jgroups.protocols.pbcast.ClientGmsImpl.joinInternal(ClientGmsImpl.java:111)
	at org.jgroups.protocols.pbcast.ClientGmsImpl.join(ClientGmsImpl.java:41)
	at org.jgroups.protocols.pbcast.GMS.down(GMS.java:1087)
	at org.jgroups.protocols.FlowControl.down(FlowControl.java:353)
	at org.jgroups.protocols.FlowControl.down(FlowControl.java:353)
	at org.jgroups.protocols.FRAG2.down(FRAG2.java:136)
	at org.jgroups.protocols.RSVP.down(RSVP.java:153)
	at org.jgroups.protocols.pbcast.STATE_TRANSFER.down(STATE_TRANSFER.java:202)
	at org.jgroups.protocols.raft.ELECTION.down(ELECTION.java:112)
	at org.jgroups.protocols.raft.RAFT.down(RAFT.java:442)
	at org.jgroups.protocols.raft.REDIRECT.down(REDIRECT.java:103)
	at org.jgroups.stack.ProtocolStack.down(ProtocolStack.java:1038)
	at org.jgroups.JChannel.down(JChannel.java:791)
	at org.jgroups.JChannel._connect(JChannel.java:564)
	... 4 more
[mac] /Users/bela/jgroups-raft$</pre>
</div>
</div>
<div class="paragraph">
<p>The error message is <code>SecurityException: join of B rejected as it would create a view with duplicate members (current view: [B|1] (2) [B, A])</code>,
which shows that view <code>{B,A}</code> already contains a member with <code>raft_id</code> <code>B</code>, and so the JOIN request of the new member
is rejected.</p>
</div>
</div>
<div class="sect2">
<h3 id="ELECTION">4.2. ELECTION</h3>
<div class="paragraph">
<p><code>ELECTION</code> is the protocol which performs leader election, as defined by Raft.
Its attributes define the election timeout and the heartbeat interval (see Raft for details).</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 1. ELECTION</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vote_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max time (ms) to wait for vote responses</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="ELECTION2">4.3. ELECTION2</h3>
<div class="paragraph">
<p><code>ELECTION2</code> is an alternative election algorithm.
It builds on top of <a href="#ELECTION">ELECTION</a> to include a pre-vote mechanism.
The pre-vote runs before delegating to the algorithm of <a href="#ELECTION">ELECTION</a>.</p>
</div>
<div class="paragraph">
<p>By design, <a href="#ELECTION">ELECTION</a> uses view changes to start election rounds and should be stable without interruptions.
<code>ELECTION2</code> is an alternative in networks with recurrent partitions that could lead to more disruptions with unnecessary election rounds.
More information about how it works is available in the design documents.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 2. ELECTION2</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vote_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max time (ms) to wait for vote responses</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="RAFT">4.4. RAFT</h3>
<div class="paragraph">
<p><code>RAFT</code> is the main protocol in jgroups-raft; it implements log appending and committing, snapshotting and log compaction,
syncing of new members and so on.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 3. RAFT</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dynamic_view_changes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, we can change <em>members</em> at runtime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log_args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arguments to the log impl, e.g. k1=v1,k2=v2. These will be passed to init()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log_class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified name of the class implementing Log</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log_dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory in which the log and snapshots are stored. Defaults to the temp dir</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log_prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The prefix of the log and snapshot. If null, the logical name of the channel is used as prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log_use_fsync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_log_cache_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max size of the log cache (0 disables the log cache)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_log_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max number of bytes a log can have until a snapshot is created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">members</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of members (logical names); majority is computed from it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processing_queue_max_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max size in items the processing queue can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">raft_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of this node. Needs to be unique and an element of members. Must not be null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resend_interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval (ms) at which AppendEntries messages are resent to members with missing log entries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_commits_immediately</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send commit message to followers immediately after leader commits (majority has consensus). Caution : it may generate more traffic than expected</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="REDIRECT">4.5. REDIRECT</h3>
<div class="paragraph">
<p>The <code>REDIRECT</code> protocol needs to be somewhere above <code>RAFT</code>. It keeps track of the current Raft leader and redirects
requests to the right leader. If there is no leader, e.g. because there&#8217;s no majority to elect one, an exception will
be thrown.</p>
</div>
</div>
<div class="sect2">
<h3 id="CLIENT">4.6. CLIENT</h3>
<div class="paragraph">
<p><code>CLIENT</code> listens on a socket for client requests. When a request is received, it is sent down where it will be forwarded
(by <code>REDIRECT</code>) to the current leader which executes the request. The responses is then sent back to the client.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 4. CLIENT</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bind_addr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bind address which should be used by the server socket. The following special values are also recognized: GLOBAL, SITE_LOCAL, LINK_LOCAL, NON_LOOPBACK, match-interface, match-host, match-address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">idle_time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of ms a thread can be idle before being removed from the thread pool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max number of threads in the thread pool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min_threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The min threads in the thread pool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to listen for client requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_buf_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of bytes of the server socket&#8217;s receive buffer</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-11-21 22:26:26 -0300
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>